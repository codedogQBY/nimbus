# 🛡️ RBAC 权限管理系统

## 📋 系统概述

本系统实现了完整的 RBAC (Role-Based Access Control) 权限管理系统，提供直观、美观的管理界面，参考了 Supabase、Auth0、AWS IAM 等业界最佳实践。

---

## ✨ 核心功能

### 1. 📊 统计总览

- **角色总数**：系统和自定义角色统计
- **权限总数**：所有可用权限
- **已分配用户**：当前已分配角色的用户数
- **今日操作**：权限操作日志统计

### 2. 🎭 角色管理

#### 功能特性

- ✅ **查看角色列表**：显示所有系统角色和自定义角色
- ✅ **角色详情**：角色名称、描述、类型
- ✅ **用户统计**：每个角色关联的用户数
- ✅ **权限统计**：每个角色拥有的权限数
- ✅ **创建角色**：创建自定义角色（待实现）
- ✅ **编辑角色**：修改角色信息（待实现）
- ✅ **删除角色**：删除自定义角色（待实现）
- ✅ **管理权限**：为角色分配/移除权限（待实现）

#### 预设角色

| 角色   | 图标 | 颜色 | 说明                           | 系统角色 |
| ------ | ---- | ---- | ------------------------------ | -------- |
| Owner  | 👑   | 红色 | 所有者，拥有所有权限           | ✅       |
| Admin  | 🛡️   | 蓝色 | 管理员，除用户管理外的所有权限 | ✅       |
| Editor | ✏️   | 紫色 | 编辑者，可编辑文件和分享       | ✅       |
| Viewer | 👁️   | 绿色 | 查看者，只读权限               | ✅       |
| Guest  | 👤   | 灰色 | 访客，临时访问权限             | ✅       |

#### UI设计

**桌面端**：

- 表格布局，清晰展示所有角色信息
- 操作下拉菜单（编辑、管理权限、删除）
- 角色图标和颜色标识

**移动端**：

- 卡片式布局
- 每个角色独立卡片
- 触摸友好的大按钮

---

### 3. 🔑 权限管理

#### 功能特性

- ✅ **按资源分组**：文件、用户、分享、存储、权限、系统
- ✅ **搜索权限**：快速查找特定权限
- ✅ **权限详情**：权限名称、描述、资源、操作
- ✅ **使用统计**：显示有多少角色使用该权限
- ✅ **手风琴展示**：桌面端可折叠分组
- ✅ **颜色分类**：每个资源有专属颜色

#### 权限分组

| 资源        | 图标 | 颜色 | 说明         |
| ----------- | ---- | ---- | ------------ |
| files       | 📁   | 蓝色 | 文件相关操作 |
| users       | 👥   | 紫色 | 用户管理     |
| shares      | 🔗   | 绿色 | 分享管理     |
| storage     | 💾   | 黄色 | 存储源管理   |
| permissions | 🔑   | 红色 | 权限管理     |
| system      | 🛡️   | 灰色 | 系统管理     |

#### 权限示例

```
files.upload      - 上传文件
files.download    - 下载文件
files.edit        - 编辑文件
files.delete      - 删除文件
users.view        - 查看用户
users.manage      - 管理用户
shares.create     - 创建分享
shares.delete     - 删除分享
storage.manage    - 管理存储源
permissions.view  - 查看权限
permissions.manage- 管理权限
```

#### UI设计

**桌面端**：

- 手风琴式分组展示
- 搜索栏过滤
- 权限代码高亮显示

**移动端**：

- 分组卡片
- 紧凑布局
- 易于浏览

---

### 4. 👥 用户角色分配

#### 功能特性

- ✅ **用户列表**：显示所有用户
- ✅ **当前角色**：每个用户的角色标签
- ✅ **快速分配**：下拉选择角色并分配（待实现）
- ✅ **Owner 保护**：Owner 用户不可修改角色
- ✅ **状态显示**：活跃/未激活状态
- ✅ **搜索用户**：按用户名或邮箱搜索

#### UI设计

**桌面端**：

- 表格布局
- 内联角色选择器
- 一键分配按钮

**移动端**：

- 用户卡片
- 展开的角色选择器
- 全宽分配按钮

---

### 5. 📜 权限日志

#### 功能特性

- ✅ **操作记录**：所有权限检查日志
- ✅ **状态显示**：授权/拒绝状态
- ✅ **用户信息**：操作用户
- ✅ **权限详情**：权限名称、资源、操作
- ✅ **时间戳**：精确到秒的时间
- ✅ **拒绝原因**：显示拒绝原因
- ✅ **过滤功能**：全部/已授权/已拒绝
- ✅ **分页显示**：每页20条
- ✅ **统计汇总**：总数、授权数、拒绝数

#### UI设计

- 时间线式布局
- 状态颜色标识（绿色授权、红色拒绝）
- 详细的操作信息
- 分页导航

---

## 🎨 设计规范

### 色彩系统

遵循主题的暖复古色调，同时为不同状态和资源类型提供清晰的视觉区分：

| 用途 | 颜色           | 说明           |
| ---- | -------------- | -------------- |
| 主色 | Primary (蓝)   | 主要按钮、角色 |
| 次色 | Secondary (紫) | 次要元素       |
| 成功 | Success (绿)   | 授权、成功状态 |
| 警告 | Warning (黄)   | 警告、提示     |
| 危险 | Danger (红)    | 拒绝、删除     |

### 布局原则

1. **响应式设计**：完美适配桌面和移动端
2. **层次分明**：统计→导航→内容
3. **操作便捷**：常用操作一键可达
4. **信息清晰**：重要信息突出显示

### 组件规范

- **卡片**：白色背景、轻微阴影、圆角
- **按钮**：图标+文字、移动端图标优先
- **表格**：桌面端使用、移动端转为卡片
- **标签**：Chip组件、颜色区分状态
- **图标**：lucide-react、统一风格

---

## 📡 API 端点

### 角色管理

```typescript
GET / api / rbac / roles; // 获取所有角色
POST / api / rbac / roles; // 创建新角色
PUT / api / rbac / roles / [id]; // 更新角色
DELETE / api / rbac / roles / [id]; // 删除角色
```

### 权限管理

```typescript
GET / api / rbac / permissions; // 获取所有权限
```

### 权限日志

```typescript
GET / api / rbac / logs; // 获取权限日志
```

### 用户角色分配

```typescript
POST / api / rbac / assign; // 分配角色给用户
DELETE / api / rbac / revoke; // 移除用户角色
```

---

## 🔒 权限要求

访问 RBAC 管理界面需要以下权限之一：

- `permissions.view` - 查看权限和角色
- `permissions.manage` - 管理权限和角色

通常只有 **Owner** 用户可以访问此界面。

---

## 🚀 使用指南

### 1. 访问权限管理

- 登录后，点击侧边栏的「权限管理」图标
- 仅 Owner 用户可见此菜单项

### 2. 查看角色

- 默认显示「角色管理」标签
- 查看所有系统角色和自定义角色
- 点击三点菜单进行操作

### 3. 查看权限

- 切换到「权限管理」标签
- 按资源分组展示所有权限
- 使用搜索框快速查找

### 4. 分配角色

- 切换到「用户分配」标签
- 选择要分配的角色
- 点击「分配」按钮确认

### 5. 查看日志

- 切换到「权限日志」标签
- 查看最近的权限操作记录
- 使用过滤器筛选状态

---

## 📱 移动端优化

### 响应式断点

- **< 640px**：手机竖屏
- **640px - 1024px**：平板
- **> 1024px**：桌面

### 移动端特性

1. **底部导航**：4个主要标签
2. **卡片布局**：替代表格
3. **全屏模态框**：表单和详情
4. **触摸友好**：大按钮、充足间距
5. **紧凑显示**：精简文本、图标优先

---

## 🔧 待实现功能

### 高优先级

- [ ] 创建自定义角色
- [ ] 编辑角色信息
- [ ] 删除自定义角色
- [ ] 为角色分配权限
- [ ] 用户角色分配功能

### 中优先级

- [ ] 批量用户操作
- [ ] 角色模板
- [ ] 权限继承
- [ ] 权限导出/导入

### 低优先级

- [ ] 权限审计报告
- [ ] 角色使用分析
- [ ] 权限建议系统
- [ ] 自定义权限创建

---

## 📊 数据库结构

### 角色表 (roles)

```sql
id              INT       主键
name            VARCHAR   角色名称（唯一）
description     TEXT      角色描述
isSystem        BOOLEAN   是否系统角色
createdAt       DATETIME  创建时间
updatedAt       DATETIME  更新时间
```

### 权限表 (permissions)

```sql
id              INT       主键
name            VARCHAR   权限名称（唯一）
description     TEXT      权限描述
resource        VARCHAR   资源类型
action          VARCHAR   操作类型
createdAt       DATETIME  创建时间
```

### 角色权限表 (role_permissions)

```sql
id              INT       主键
roleId          INT       角色ID
permissionId    INT       权限ID
```

### 用户角色表 (user_roles)

```sql
id              INT       主键
userId          INT       用户ID
roleId          INT       角色ID
assignedAt      DATETIME  分配时间
assignedBy      INT       分配者ID
```

### 权限日志表 (permission_logs)

```sql
id              INT       主键
userId          INT       用户ID
permission      VARCHAR   权限名称
resource        VARCHAR   资源
action          VARCHAR   操作
granted         BOOLEAN   是否授权
reason          TEXT      拒绝原因
createdAt       DATETIME  创建时间
```

---

## 🎯 设计参考

本系统设计参考了以下业界最佳实践：

1. **Supabase**：清晰的角色权限界面、直观的分配流程
2. **Auth0**：专业的权限管理、详细的日志系统
3. **AWS IAM**：完整的权限体系、精细的权限控制
4. **Ant Design Pro**：优秀的表格和表单设计
5. **HeroUI**：现代的组件库、美观的UI

---

## 💡 最佳实践

### 权限设计

1. **最小权限原则**：默认拒绝，按需授权
2. **角色分离**：明确区分系统角色和自定义角色
3. **权限粒度**：资源.操作 的命名规范
4. **日志审计**：记录所有权限操作

### 用户体验

1. **快速搜索**：提供搜索和过滤
2. **批量操作**：支持批量分配和移除
3. **即时反馈**：操作后立即显示结果
4. **错误处理**：友好的错误提示

### 安全性

1. **Owner 保护**：Owner 角色不可修改
2. **权限检查**：所有操作都需要权限
3. **日志记录**：完整的操作审计
4. **会话管理**：Token 过期自动跳转

---

**最后更新**: 2024-10-11  
**文档版本**: v1.0  
**设计师**: AI Assistant
